{% extends "base.html" %}

{% block title %}#{{ tag }}{% endblock %}
{% block current_path %}/tags/{{ tag }}{% endblock %}

{% block content %}
<!-- Command Output Header -->
<div class="output-block">
    <div class="output-line">
        <span class="prompt-symbol">$</span> <span style="color: var(--term-green);">grep --tag={{ tag }} ~/garden/</span>
    </div>
    <div class="output-line" style="margin-top: 0.5rem; color: var(--term-gray);">
        Found {{ total }} items tagged with <span style="color: var(--term-magenta);">#{{ tag }}</span>
    </div>
</div>

<!-- Tagged Content List -->
{% if posts %}
<ul class="content-list">
    {% for post in posts %}
    <li class="content-item">
        <span class="content-type">
            {% if post.content_type == 'notes' %}
            <span style="color: var(--term-cyan);">note</span>
            {% elif post.content_type == 'til' %}
            <span style="color: var(--term-yellow);">til</span>
            {% elif post.content_type == 'bookmarks' %}
            <span style="color: var(--term-magenta);">link</span>
            {% else %}
            <span style="color: var(--term-gray);">{{ post.content_type }}</span>
            {% endif %}
        </span>
        <span class="content-title">
            {% if post.content_type == 'bookmarks' and post.url %}
            <a href="{{ post.url }}" target="_blank" rel="noopener noreferrer">
                {{ post.title }} <span style="color: var(--term-gray);">↗</span>
            </a>
            {% else %}
            <a href="/{{ post.content_type }}/{{ post.slug }}">{{ post.title }}</a>
            {% endif %}
            {% if post.growth_stage %}
            <span class="growth-stage growth-{{ post.growth_stage|lower }}">[{{ post.growth_stage|lower }}]</span>
            {% endif %}
        </span>
        <span class="content-date">{{ post.created }}</span>
    </li>
    {% if post.tags %}
    <li class="content-meta">
        <span class="tags">
            {% for tag_item in post.tags[:4] %}
            <a href="/tags/{{ tag_item }}" class="tag">{{ tag_item }}</a>
            {% endfor %}
        </span>
    </li>
    {% endif %}
    {% if post.excerpt %}
    <li class="content-meta" style="color: var(--term-gray);">
        {{ post.excerpt[:120] }}{% if post.excerpt|length > 120 %}...{% endif %}
    </li>
    {% endif %}
    {% endfor %}
</ul>
{% else %}
<div class="output-block">
    <div class="output-line" style="color: var(--term-amber);">
        No content found with tag #{{ tag }}
    </div>
    <div class="output-line">
        <a href="/topics" style="color: var(--term-cyan);">Browse all tags →</a>
    </div>
</div>
{% endif %}

<!-- Related Tags -->
{% if related_tags %}
<div class="output-block" style="margin-top: 2rem; border-top: 1px dashed var(--term-gray); padding-top: 1rem;">
    <div class="output-line" style="color: var(--term-amber);">## Related Tags</div>
    <div class="output-line" style="color: var(--term-gray);">Tags that frequently appear with #{{ tag }}:</div>
    <div class="tags" style="margin-top: 0.5rem;">
        {% for tag_name, count in related_tags %}
        <a href="/tags/{{ tag_name }}" class="tag">{{ tag_name }} <span style="color: var(--term-gray);">({{ count }})</span></a>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Navigation -->
<div class="output-block" style="margin-top: 1.5rem;">
    <a href="/topics" style="color: var(--term-cyan);">[← back to tags/]</a>
</div>
{% endblock %}
